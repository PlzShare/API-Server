<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="workspaceUsers">
	<select id="findUser" parameterType="Long" resultType="workspaceUsers">
		<![CDATA[
			select b.id as userid, a.user_no as userNo, nickname, role
				from workspace_user a, user b
				where a.user_no = b.no
				and a.workspace_no = #{workspaceNo}
				order by b.id desc
		]]>
	</select>
	
	<insert id="inviteAdmin" parameterType="workspaceUsers">
		<![CDATA[
			insert into workspace_user(user_no, workspace_no, reg_date, role) values(#{userNo}, #{workspaceNo}, now(), 'admin');
		]]>
	</insert>
	
	<insert id="inviteUser" parameterType="workspaceUsers">
		<![CDATA[
			insert into workspace_user(user_no, workspace_no) values(#{userNo}, #{workspaceNo});
		]]>
	</insert>
	 
	<delete id="leave" parameterType="workspaceUsers">
		<![CDATA[
			delete from workspace_user where user_no = #{userNo}
			and workspace_no = #{workspaceNo}
		]]>
	</delete>
	
	<delete id="deleteNotiUser" parameterType="workspaceUsers">
		<![CDATA[
			delete from workspace_user 
				where user_no = #{userNo }
				and workspace_no = #{workspaceNo }
		]]>
	</delete>
	
	<update id="changeRoleAU" parameterType="changeUser">
		<![CDATA[
		update workspace_user set role = 'user'
		where role = 'admin'
		  and user_no = #{adminNo }
		  and workspace_no = #{workspaceNo}
		]]>
	</update>
	
	<update id="changeRoleUA" parameterType="changeUser">
		<![CDATA[
		update workspace_user set role = 'admin'
		where role = 'user'
		  and user_no = #{userNo }
		  and workspace_no = #{workspaceNo}
		]]>
	</update>
	
	<update id="changeDate" parameterType="workspaceUsers">
		<![CDATA[
		update workspace_user
			set reg_date = now()
		    where user_no = #{userNo }
		    and workspace_no = #{workspaceNo }
		]]>
	</update>
	
</mapper>