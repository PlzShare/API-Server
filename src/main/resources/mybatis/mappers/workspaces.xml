<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="workspace">

	<select id="findAll" parameterType="long" resultType="workspaces">
		<![CDATA[
		select a.no as no, a.name as name, a.created_at as created_at, a.user_no as user_no
		from workspace a join 
							(select user_no, workspace_no from workspace_user
							 where reg_date != '9999-12-31 00:00:00' and user_no = #{userNo}) b	 
						on a.no = b.workspace_no;
		]]>
	</select>
	
	<select id="find" parameterType="long" resultType="workspaces">
		<![CDATA[
		select no, name, created_at, user_no
		from workspace
		where no = #{wno};
		]]>
	</select>
	
	<insert id="insert" parameterType="workspaces" useGeneratedKeys="true" keyProperty="no">
		<![CDATA[
		insert into workspace(name, user_no)
		values(#{name}, #{userNo});
		]]>
	</insert>

	<insert id="update" parameterType="workspaces">
		<![CDATA[
		update workspace
		set name = #{name}
		where no = #{no};
		]]>
	</insert>
		
	<delete id="delete" parameterType="long">
		<![CDATA[
		delete from workspace
		where no = #{no}
		]]>
	</delete>
			
	<select id="search" parameterType="map" resultType="workspaces">
		<if test='searchType == "name"'>
			<![CDATA[
			select no, name, created_at, user_no
			from workspace
			where name like #{keyword};
			]]>
		</if>

		<if test='searchType == "id"'>
			<![CDATA[
			select b.no as no, b.name as name, b.created_at as createAt, b.user_no as userNo
			from user a join workspace b on a.no = b.user_no
			where id like #{keyword};
			]]>	
		</if>
	</select>
</mapper>